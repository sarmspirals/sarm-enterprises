<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SARM ENTERPRISES</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Admin Styles */
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .admin-stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .admin-stats span {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .form-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 5px;
        }
        
        /* Multi-image input */
        .images-input-container {
            margin-bottom: 15px;
            border: 1px dashed #ddd;
            padding: 15px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .image-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .image-input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .btn-add-image {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px dashed #1976d2;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .btn-add-image:hover {
            background: #bbdefb;
        }
        
        .btn-remove-image {
            background: #ffebee;
            color: #d32f2f;
            border: 1px solid #ffcdd2;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .btn-remove-image:hover {
            background: #ffcdd2;
        }
        
        .image-previews {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 5px;
            min-height: 120px;
        }
        
        .image-preview-item {
            width: 120px;
            text-align: center;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            background: white;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100px;
            object-fit: contain;
            border-radius: 3px;
            margin-bottom: 5px;
            background: #f5f5f5;
        }
        
        .image-preview-item span {
            display: block;
            font-size: 11px;
            margin-top: 5px;
            word-break: break-all;
            color: #666;
        }
        
        /* Categories */
        .categories-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            min-height: 50px;
        }
        
        .category-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .category-tag button {
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Products Grid in Admin */
        .admin-products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .admin-product-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .admin-product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .admin-product-images {
            display: flex;
            overflow-x: auto;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            gap: 10px;
            min-height: 100px;
        }
        
        .admin-product-images img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: white;
            padding: 5px;
            flex-shrink: 0;
        }
        
        .admin-product-info {
            padding: 20px;
        }
        
        .admin-product-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .product-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .product-status.in-stock {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .product-status.low-stock {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .product-status.out-of-stock {
            background: #ffebee;
            color: #c62828;
        }
        
        /* Quotes List */
        .quotes-list {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 10px;
        }
        
        .quote-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-left: 4px solid var(--primary-color);
        }
        
        .quote-item span {
            flex: 1;
            padding-right: 15px;
            font-style: italic;
            color: #555;
        }
        
        .quote-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        
        /* Chart Container */
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        /* Products Filter */
        .products-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .products-filter select,
        .products-filter input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            min-width: 200px;
        }
        
        .products-filter input {
            flex: 1;
            min-width: 250px;
        }
        
        /* GitHub Info */
        .github-info {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .github-info pre {
            background: #2d2d2d;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .github-info code {
            background: #e0e0e0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #333;
        }
        
        .github-info ul {
            margin: 10px 0 10px 20px;
            padding-left: 0;
        }
        
        .github-info li {
            margin-bottom: 8px;
            color: #555;
        }
        
        /* Instructions */
        .instructions {
            background: #fff8e1;
            border-left: 4px solid #ffb300;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .instructions p {
            margin: 5px 0;
            color: #5d4037;
            font-size: 14px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .admin-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .admin-stats span {
                text-align: center;
            }
            
            .products-filter {
                flex-direction: column;
            }
            
            .products-filter select,
            .products-filter input {
                min-width: 100%;
            }
            
            .admin-products-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .quote-actions {
                flex-direction: column;
            }
        }
        
        /* File upload info */
        .file-info {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 5px;
            padding: 12px;
            margin: 10px 0;
            font-size: 13px;
            color: #2e7d32;
        }
        
        /* Image error state */
        .image-error {
            border-color: #ffcdd2 !important;
            background: #ffebee !important;
        }
        
        .error-message {
            color: #d32f2f;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }
        
        /* Image validation */
        .image-validation {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-validation i {
            font-size: 16px;
        }
        
        .valid {
            color: #4caf50;
        }
        
        .invalid {
            color: #f44336;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1><i class="fas fa-user-shield"></i> Admin Dashboard</h1>
                <p class="tagline">SARM ENTERPRISES Management</p>
            </div>
            <button id="logoutBtn" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </nav>

    <div class="admin-container">
        <div class="admin-header">
            <h2>Welcome to Admin Panel</h2>
            <div class="admin-stats">
                <span id="totalProducts">0 Products</span>
                <span id="totalOrders">0 Orders</span>
                <span id="lowStock">0 Low Stock</span>
                <span id="totalCategories">0 Categories</span>
                <span id="totalQuotes">5 Quotes</span>
            </div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <p><strong>⚠️ Important:</strong> To fix image errors, upload images to your GitHub repository in the <code>assets/products/</code> folder.</p>
            <p>Enter only the filename (e.g., <code>notebook1.jpg</code>). The system will automatically look for images at <code>assets/products/your-filename.jpg</code></p>
        </div>

        <!-- Add/Edit Product Form -->
        <div class="form-card">
            <h3><i class="fas fa-plus-circle"></i> Add/Edit Product</h3>
            <form id="productForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="productName"><i class="fas fa-tag"></i> Product Name *</label>
                        <input type="text" id="productName" name="productName" required 
                               placeholder="e.g., Spiral Notebook 200 Pages">
                    </div>
                    <div class="form-group">
                        <label for="productCategory"><i class="fas fa-layer-group"></i> Category *</label>
                        <div style="display: flex; gap: 10px;">
                            <select id="productCategory" name="productCategory" required style="flex: 1;">
                                <option value="">Select Category</option>
                                <!-- Categories will be loaded dynamically -->
                            </select>
                            <button type="button" id="refreshCategories" class="btn-small" title="Refresh Categories" onclick="loadCategories()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productPages"><i class="fas fa-file-alt"></i> Number of Pages *</label>
                        <input type="number" id="productPages" name="productPages" required 
                               placeholder="e.g., 200" min="1">
                    </div>
                    <div class="form-group">
                        <label for="productPrice"><i class="fas fa-rupee-sign"></i> Price (₹) *</label>
                        <input type="number" id="productPrice" name="productPrice" required 
                               placeholder="e.g., 69" step="0.01" min="1">
                    </div>
                    <div class="form-group">
                        <label for="productStock"><i class="fas fa-box"></i> Stock Quantity *</label>
                        <input type="number" id="productStock" name="productStock" required 
                               placeholder="e.g., 50" min="0">
                    </div>
                </div>
                
                <!-- Multi-image URLs -->
                <div class="form-group">
                    <label><i class="fas fa-images"></i> Product Images *</label>
                    <div class="file-info">
                        <p><i class="fas fa-info-circle"></i> Enter image filenames (e.g., <code>notebook1.jpg</code>)</p>
                        <p><strong>Example:</strong> If your image is at <code>assets/products/notebook1.jpg</code>, just enter <code>notebook1.jpg</code></p>
                    </div>
                    <div class="images-input-container" id="imagesContainer">
                        <div class="image-input-group">
                            <input type="text" class="image-url" 
                                   placeholder="Enter image filename (e.g., notebook1.jpg)" 
                                   data-index="0" required>
                            <button type="button" class="btn-remove-image" onclick="removeImageInput(this)" disabled>×</button>
                        </div>
                    </div>
                    <button type="button" class="btn-add-image" onclick="addImageInput()">
                        <i class="fas fa-plus"></i> Add Another Image
                    </button>
                    
                    <div id="imagePreviewContainer" class="image-preview-container">
                        <div class="image-previews" id="imagePreviews">
                            <!-- Image previews will be shown here -->
                            <div style="width: 100%; text-align: center; padding: 30px; color: #999;">
                                <i class="fas fa-images" style="font-size: 40px; margin-bottom: 10px;"></i>
                                <p>Image previews will appear here after entering filenames</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="productDescription"><i class="fas fa-align-left"></i> Description</label>
                    <textarea id="productDescription" name="productDescription" rows="3" 
                              placeholder="Describe the product features, quality, and specifications..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="productFeatures"><i class="fas fa-star"></i> Features (comma separated)</label>
                    <input type="text" id="productFeatures" name="productFeatures"
                           placeholder="e.g., Premium Paper, Spiral Binding, Durable Cover, Waterproof">
                    <small style="color: #666; display: block; margin-top: 5px;">Separate features with commas</small>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="submitBtn">
                        <i class="fas fa-save"></i> Add Product
                    </button>
                    <button type="button" class="btn-secondary" id="cancelEdit" style="display: none;">
                        <i class="fas fa-times"></i> Cancel Edit
                    </button>
                </div>
                <input type="hidden" id="editProductId">
            </form>
        </div>

        <!-- Category Management -->
        <div class="form-card">
            <h3><i class="fas fa-layer-group"></i> Category Management</h3>
            <div class="form-group">
                <label>Current Categories</label>
                <div class="categories-list" id="categoriesList">
                    <!-- Categories will be loaded here -->
                </div>
                <div style="margin-top: 20px;">
                    <h4>Add New Category</h4>
                    <div style="display: flex; gap: 10px; align-items: flex-end;">
                        <div style="flex: 1;">
                            <input type="text" id="newCategoryInput" placeholder="Enter new category name">
                            <small style="color: #666; display: block; margin-top: 5px;">Use lowercase with hyphens (e.g., premium-notebooks)</small>
                        </div>
                        <button type="button" class="btn-primary" id="addCategoryBtn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products List -->
        <div class="form-card">
            <h3><i class="fas fa-list"></i> Current Products</h3>
            <div class="products-filter">
                <select id="filterCategory">
                    <option value="all">All Categories</option>
                </select>
                <input type="text" id="searchProduct" placeholder="Search products by name or description...">
                <button type="button" class="btn-secondary" id="refreshProducts">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div id="productsList" class="admin-products-grid">
                <!-- Products will be loaded here -->
            </div>
        </div>

        <!-- Quotes Management -->
        <div class="form-card">
            <h3><i class="fas fa-quote-left"></i> Moving Quotes Management</h3>
            <p style="color: #666; margin-bottom: 20px;">Manage quotes displayed in the moving carousel on homepage (Minimum 5 quotes required)</p>
            
            <div class="form-group">
                <label for="newQuote">Add New Quote</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="newQuote" placeholder="Enter a motivational quote..." style="flex: 1;">
                    <button type="button" class="btn-primary" id="addQuoteBtn">
                        <i class="fas fa-plus"></i> Add Quote
                    </button>
                </div>
            </div>
            
            <h4>Current Quotes (5 Minimum)</h4>
            <div id="quotesList" class="quotes-list">
                <!-- Quotes will be loaded here -->
            </div>
        </div>

        <!-- Stock Summary -->
        <div class="form-card">
            <h3><i class="fas fa-chart-bar"></i> Stock Summary</h3>
            <div class="chart-container">
                <canvas id="stockChart"></canvas>
            </div>
        </div>

        <!-- Customer Feedback Manager -->
        <div class="form-card">
            <h3><i class="fas fa-comments"></i> Customer Feedback Manager</h3>
            <p>Review and manage testimonials submitted by customers.</p>
            
            <div class="admin-actions" style="margin-bottom: 1.5rem;">
                <button class="btn-primary" id="refreshPendingBtn">
                    <i class="fas fa-sync-alt"></i> Refresh Pending List
                </button>
                <button class="btn-secondary" id="viewAllBtn">
                    <i class="fas fa-list"></i> View All
                </button>
            </div>
            
            <h4>Pending Review</h4>
            <div id="pendingFeedbackList">
                <p><i>Click "Refresh Pending List" to load submissions.</i></p>
            </div>
        </div>

        <!-- FAQ Management -->
        <div class="form-card">
            <h3><i class="fas fa-question-circle"></i> FAQ Management</h3>
            <p>Manage Frequently Asked Questions shown on the FAQ page.</p>
            
            <!-- Add New FAQ Form -->
            <h4>Add New FAQ</h4>
            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
                <div class="form-group">
                    <label for="faqQuestion"><i class="fas fa-question"></i> Question</label>
                    <input type="text" id="faqQuestion" placeholder="e.g., What is your delivery area?">
                </div>
                <div class="form-group">
                    <label for="faqAnswer"><i class="fas fa-comment-alt"></i> Answer</label>
                    <textarea id="faqAnswer" rows="3" placeholder="e.g., We offer free delivery within 5km..."></textarea>
                </div>
                <div class="form-group">
                    <label for="faqOrder"><i class="fas fa-sort-numeric-down"></i> Display Order</label>
                    <input type="number" id="faqOrder" placeholder="1" value="1">
                    <small>Lower numbers appear first on the FAQ page.</small>
                </div>
                <button class="btn-primary" id="addFaqBtn">
                    <i class="fas fa-plus-circle"></i> Add FAQ
                </button>
            </div>
            
            <!-- Existing FAQs List -->
            <h4>Existing FAQs</h4>
            <button class="btn-secondary" id="refreshFaqsBtn" style="margin-bottom: 1rem;">
                <i class="fas fa-sync-alt"></i> Refresh List
            </button>
            <div id="faqsListAdmin">
                <p style="text-align: center; padding: 2rem; color: #999;">
                    Click "Refresh List" to load existing FAQs.
                </p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="admin.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Multi-image management
        let imageInputs = 1;
        
        // Add event listener to form to handle submission
        document.addEventListener('DOMContentLoaded', function() {
            // Load categories when page loads
            if (window.loadCategories) {
                loadCategories();
            }
            
            // Initialize image previews
            updateImagePreviews();
        });
        
        function addImageInput() {
            const container = document.getElementById('imagesContainer');
            const newInput = document.createElement('div');
            newInput.className = 'image-input-group';
            newInput.innerHTML = `
                <input type="text" class="image-url" 
                       placeholder="Enter image filename (e.g., notebook${imageInputs + 1}.jpg)" 
                       data-index="${imageInputs}"
                       oninput="previewImage(this)">
                <button type="button" class="btn-remove-image" onclick="removeImageInput(this)">×</button>
            `;
            container.appendChild(newInput);
            imageInputs++;
            
            // Enable remove buttons if more than one input
            const removeButtons = container.querySelectorAll('.btn-remove-image');
            if (removeButtons.length > 1) {
                removeButtons.forEach(btn => btn.disabled = false);
            }
            
            updateImagePreviews();
        }
        
        function removeImageInput(button) {
            const container = document.getElementById('imagesContainer');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateImagePreviews();
            }
            
            // Disable remove button if only one input remains
            const removeButtons = container.querySelectorAll('.btn-remove-image');
            if (removeButtons.length === 1) {
                removeButtons[0].disabled = true;
            }
        }
        
        function previewImage(input) {
            updateImagePreviews();
        }
        
        function updateImagePreviews() {
            const inputs = document.querySelectorAll('.image-url');
            const previewsContainer = document.getElementById('imagePreviews');
            
            // Clear previous previews
            previewsContainer.innerHTML = '';
            
            let hasImages = false;
            
            inputs.forEach((input, index) => {
                const filename = input.value.trim();
                if (filename) {
                    hasImages = true;
                    
                    // Remove any existing error class
                    input.classList.remove('image-error');
                    
                    // SIMPLE IMAGE SOURCE - Fixed to prevent 404 errors
                    const imageUrl = `assets/products/${filename}`;
                    const preview = document.createElement('div');
                    preview.className = 'image-preview-item';
                    preview.dataset.index = index;
                    
                    preview.innerHTML = `
                        <img src="${imageUrl}" alt="Preview" onerror="this.onerror=null; this.src='https://via.placeholder.com/120x100?text=Image+${index + 1}'">
                        <span>${filename}</span>
                    `;
                    
                    previewsContainer.appendChild(preview);
                }
            });
            
            if (!hasImages) {
                previewsContainer.innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 30px; color: #999;">
                        <i class="fas fa-images" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>Enter image filenames above to see previews</p>
                    </div>
                `;
            }
        }
        
        // Get image URLs from form
        function getImageUrls() {
            const inputs = document.querySelectorAll('.image-url');
            const urls = [];
            
            inputs.forEach(input => {
                const value = input.value.trim();
                if (value) {
                    urls.push(value);
                }
            });
            
            return urls;
        }
        
        // Set image URLs in form for editing
        function setImageUrls(urls) {
            const container = document.getElementById('imagesContainer');
            container.innerHTML = '';
            
            if (urls && urls.length > 0) {
                urls.forEach((url, index) => {
                    const div = document.createElement('div');
                    div.className = 'image-input-group';
                    div.innerHTML = `
                        <input type="text" class="image-url" 
                               value="${url}" 
                               data-index="${index}"
                               oninput="previewImage(this)">
                        <button type="button" class="btn-remove-image" onclick="removeImageInput(this)">×</button>
                    `;
                    container.appendChild(div);
                });
                imageInputs = urls.length;
            } else {
                // Add one empty input if no images
                const div = document.createElement('div');
                div.className = 'image-input-group';
                div.innerHTML = `
                    <input type="text" class="image-url" 
                           placeholder="Enter image filename (e.g., notebook1.jpg)" 
                           data-index="0" required
                           oninput="previewImage(this)">
                    <button type="button" class="btn-remove-image" onclick="removeImageInput(this)" disabled>×</button>
                `;
                container.appendChild(div);
                imageInputs = 1;
            }
            
            // Enable/disable remove buttons
            const removeButtons = container.querySelectorAll('.btn-remove-image');
            if (removeButtons.length > 1) {
                removeButtons.forEach(btn => btn.disabled = false);
            } else {
                removeButtons[0].disabled = true;
            }
            
            updateImagePreviews();
        }
        
        // Global functions to be called from admin.js
        window.setProductFormData = function(product) {
            document.getElementById('productName').value = product.name || '';
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('productPages').value = product.pages || '';
            document.getElementById('productPrice').value = product.price || '';
            document.getElementById('productStock').value = product.stock || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productFeatures').value = product.features || '';
            document.getElementById('editProductId').value = product.id || '';
            
            // Set images
            setImageUrls(product.images || []);
            
            // Update button text
            document.getElementById('submitBtn').innerHTML = '<i class="fas fa-save"></i> Update Product';
            document.getElementById('cancelEdit').style.display = 'inline-block';
        };
        
        window.resetProductForm = function() {
            document.getElementById('productForm').reset();
            document.getElementById('editProductId').value = '';
            document.getElementById('submitBtn').innerHTML = '<i class="fas fa-save"></i> Add Product';
            document.getElementById('cancelEdit').style.display = 'none';
            
            // Reset images to one input
            setImageUrls([]);
        };
        
        // Cancel edit button
        document.getElementById('cancelEdit').addEventListener('click', function() {
            if (window.resetForm) {
                window.resetForm();
            } else if (window.resetProductForm) {
                window.resetProductForm();
            }
        });
    </script>
</body>
</html>
