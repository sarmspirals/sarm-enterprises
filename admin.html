<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SARM ENTERPRISES</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Admin Styles */
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .admin-stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .admin-stats span {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .form-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 5px;
        }
        
        /* Multi-image input */
        .images-input-container {
            margin-bottom: 15px;
            border: 1px dashed #ddd;
            padding: 15px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .image-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .image-input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .btn-add-image {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px dashed #1976d2;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .btn-add-image:hover {
            background: #bbdefb;
        }
        
        .btn-remove-image {
            background: #ffebee;
            color: #d32f2f;
            border: 1px solid #ffcdd2;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .btn-remove-image:hover {
            background: #ffcdd2;
        }
        
        .image-previews {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 5px;
            min-height: 120px;
        }
        
        .image-preview-item {
            width: 120px;
            text-align: center;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            background: white;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100px;
            object-fit: contain;
            border-radius: 3px;
            margin-bottom: 5px;
            background: #f5f5f5;
        }
        
        .image-preview-item span {
            display: block;
            font-size: 11px;
            margin-top: 5px;
            word-break: break-all;
            color: #666;
        }
        
        /* Categories */
        .categories-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            min-height: 50px;
        }
        
        .category-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .category-tag button {
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Products Grid in Admin */
        .admin-products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .admin-product-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .admin-product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .admin-product-images {
            display: flex;
            overflow-x: auto;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            gap: 10px;
            min-height: 100px;
        }
        
        .admin-product-images img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: white;
            padding: 5px;
            flex-shrink: 0;
        }
        
        .admin-product-info {
            padding: 20px;
        }
        
        .admin-product-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .product-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .product-status.in-stock {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .product-status.low-stock {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .product-status.out-of-stock {
            background: #ffebee;
            color: #c62828;
        }
        
        /* Chart Container */
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        /* Products Filter */
        .products-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .products-filter select,
        .products-filter input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            min-width: 200px;
        }
        
        .products-filter input {
            flex: 1;
            min-width: 250px;
        }
        
        /* GitHub Info */
        .github-info {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .github-info pre {
            background: #2d2d2d;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .github-info code {
            background: #e0e0e0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #333;
        }
        
        .github-info ul {
            margin: 10px 0 10px 20px;
            padding-left: 0;
        }
        
        .github-info li {
            margin-bottom: 8px;
            color: #555;
        }
        
        /* Instructions */
        .instructions {
            background: #fff8e1;
            border-left: 4px solid #ffb300;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .instructions p {
            margin: 5px 0;
            color: #5d4037;
            font-size: 14px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        /* Enhanced Quotes Management Styles */
        .quote-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }
        
        .quote-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .quote-text {
            font-size: 16px;
            font-style: italic;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .quote-author {
            color: #666;
            font-weight: 500;
            font-size: 14px;
        }
        
        .quote-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: #888;
            font-size: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .quote-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .order-input {
            width: 70px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        /* Toggle Switch for Quote Status */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #28a745;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Message Styles */
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading i {
            font-size: 40px;
            margin-bottom: 20px;
            color: #667eea;
        }
        
        /* File upload info */
        .file-info {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 5px;
            padding: 12px;
            margin: 10px 0;
            font-size: 13px;
            color: #2e7d32;
        }
        
        /* Image error state */
        .image-error {
            border-color: #ffcdd2 !important;
            background: #ffebee !important;
        }
        
        .error-message {
            color: #d32f2f;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }
        
        /* Image validation */
        .image-validation {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-validation i {
            font-size: 16px;
        }
        
        .valid {
            color: #4caf50;
        }
        
        .invalid {
            color: #f44336;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .admin-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .admin-stats span {
                text-align: center;
            }
            
            .products-filter {
                flex-direction: column;
            }
            
            .products-filter select,
            .products-filter input {
                min-width: 100%;
            }
            
            .admin-products-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .quote-actions {
                flex-direction: column;
            }
            
            .quote-meta {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1><i class="fas fa-user-shield"></i> Admin Dashboard</h1>
                <p class="tagline">SARM ENTERPRISES Management</p>
            </div>
            <button id="logoutBtn" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </nav>

    <div class="admin-container">
        <div class="admin-header">
            <h2>Welcome to Admin Panel</h2>
            <div class="admin-stats">
                <span id="totalProducts">0 Products</span>
                <span id="totalOrders">0 Orders</span>
                <span id="lowStock">0 Low Stock</span>
                <span id="totalCategories">0 Categories</span>
                <span id="totalQuotes">0 Quotes</span>
            </div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <p><strong>⚠️ Important:</strong> To fix image errors, upload images to your GitHub repository in the <code>assets/products/</code> folder.</p>
            <p>Enter only the filename (e.g., <code>notebook1.jpg</code>). The system will automatically look for images at <code>assets/products/your-filename.jpg</code></p>
        </div>

        <!-- Add/Edit Product Form -->
        <div class="form-card">
            <h3><i class="fas fa-plus-circle"></i> Add/Edit Product</h3>
            <form id="productForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="productName"><i class="fas fa-tag"></i> Product Name *</label>
                        <input type="text" id="productName" name="productName" required 
                               placeholder="e.g., Spiral Notebook">
                    </div>
                    <div class="form-group">
                        <label for="productCategory"><i class="fas fa-layer-group"></i> Category *</label>
                        <div style="display: flex; gap: 10px;">
                            <select id="productCategory" name="productCategory" required style="flex: 1;">
                                <option value="">Select Category</option>
                                <!-- Categories will be loaded dynamically -->
                            </select>
                            <button type="button" id="refreshCategories" class="btn-small" title="Refresh Categories" onclick="loadCategories()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productPrice"><i class="fas fa-rupee-sign"></i> Price (₹) *</label>
                        <input type="number" id="productPrice" name="productPrice" required 
                               placeholder="e.g., 69" step="0.01" min="1">
                    </div>
                    <div class="form-group">
                        <label for="productStock"><i class="fas fa-box"></i> Stock Quantity *</label>
                        <input type="number" id="productStock" name="productStock" required 
                               placeholder="e.g., 50" min="0">
                    </div>
                </div>
                
                <!-- Multi-image URLs -->
                <div class="form-group">
                    <label><i class="fas fa-images"></i> Product Images *</label>
                    <div class="file-info">
                        <p><i class="fas fa-info-circle"></i> Enter image filenames (e.g., <code>notebook1.jpg</code>)</p>
                        <p><strong>Example:</strong> If your image is at <code>assets/products/notebook1.jpg</code>, just enter <code>notebook1.jpg</code></p>
                    </div>
                    <div class="images-input-container" id="imagesContainer">
                        <div class="image-input-group">
                            <input type="text" class="image-url" 
                                   placeholder="Enter image filename (e.g., notebook1.jpg)" 
                                   data-index="0" required>
                            <button type="button" class="btn-remove-image" onclick="removeImageInput(this)" disabled>×</button>
                        </div>
                    </div>
                    <button type="button" class="btn-add-image" onclick="addImageInput()">
                        <i class="fas fa-plus"></i> Add Another Image
                    </button>
                    
                    <div id="imagePreviewContainer" class="image-preview-container">
                        <div class="image-previews" id="imagePreviews">
                            <!-- Image previews will be shown here -->
                            <div style="width: 100%; text-align: center; padding: 30px; color: #999;">
                                <i class="fas fa-images" style="font-size: 40px; margin-bottom: 10px;"></i>
                                <p>Image previews will appear here after entering filenames</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="productDescription"><i class="fas fa-align-left"></i> Description</label>
                    <textarea id="productDescription" name="productDescription" rows="3" 
                              placeholder="Describe the product features, quality, and specifications..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="productFeatures"><i class="fas fa-star"></i> Features (comma separated)</label>
                    <input type="text" id="productFeatures" name="productFeatures"
                           placeholder="e.g., Premium Paper, Spiral Binding, Durable Cover, Waterproof">
                    <small style="color: #666; display: block; margin-top: 5px;">Separate features with commas</small>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="submitBtn">
                        <i class="fas fa-save"></i> Add Product
                    </button>
                    <button type="button" class="btn-secondary" id="cancelEdit" style="display: none;">
                        <i class="fas fa-times"></i> Cancel Edit
                    </button>
                </div>
                <input type="hidden" id="editProductId">
            </form>
        </div>

        <!-- Category Management -->
        <div class="form-card">
            <h3><i class="fas fa-layer-group"></i> Category Management</h3>
            <div class="form-group">
                <label>Current Categories</label>
                <div class="categories-list" id="categoriesList">
                    <!-- Categories will be loaded here -->
                </div>
                <div style="margin-top: 20px;">
                    <h4>Add New Category</h4>
                    <div style="display: flex; gap: 10px; align-items: flex-end;">
                        <div style="flex: 1;">
                            <input type="text" id="newCategoryInput" placeholder="Enter new category name">
                            <small style="color: #666; display: block; margin-top: 5px;">Use lowercase with hyphens (e.g., premium-notebooks)</small>
                        </div>
                        <button type="button" class="btn-primary" id="addCategoryBtn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products List -->
        <div class="form-card">
            <h3><i class="fas fa-list"></i> Current Products</h3>
            <div class="products-filter">
                <select id="filterCategory">
                    <option value="all">All Categories</option>
                </select>
                <input type="text" id="searchProduct" placeholder="Search products by name or description...">
                <button type="button" class="btn-secondary" id="refreshProducts">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div id="productsList" class="admin-products-grid">
                <!-- Products will be loaded here -->
            </div>
        </div>

        <!-- Enhanced Quotes Management -->
        <div class="form-card">
            <h3><i class="fas fa-quote-left"></i> Quotes Management</h3>
            <p style="color: #666; margin-bottom: 20px;">Manage inspirational quotes displayed on the website.</p>
            
            <!-- Message Display -->
            <div class="message" id="quotesMessage"></div>
            
            <!-- Add/Edit Quote Form -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                <h4 id="quoteFormTitle">Add New Quote</h4>
                <form id="quoteForm">
                    <input type="hidden" id="quoteId">
                    
                    <div class="form-group">
                        <label for="quoteText"><i class="fas fa-quote-right"></i> Quote Text *</label>
                        <textarea id="quoteText" class="form-control" 
                                  placeholder="Enter inspirational quote..." 
                                  rows="3" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="quoteAuthor"><i class="fas fa-user"></i> Author *</label>
                        <input type="text" id="quoteAuthor" class="form-control" 
                               placeholder="Author name..." required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="quoteOrder"><i class="fas fa-sort-numeric-down"></i> Display Order</label>
                            <input type="number" id="quoteOrder" class="order-input" 
                                   value="1" min="1" required>
                            <small style="color: #666; display: block; margin-top: 5px;">Lower numbers appear first</small>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-toggle-on"></i> Status</label>
                            <div style="display: flex; align-items: center; margin-top: 10px;">
                                <span id="statusText">Active</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="quoteStatus" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="submitQuoteBtn">
                            <i class="fas fa-plus"></i> Add Quote
                        </button>
                        <button type="button" class="btn-secondary" id="cancelQuoteBtn" style="display: none;">
                            <i class="fas fa-times"></i> Cancel Edit
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Quotes List -->
            <h4>Existing Quotes</h4>
            <div id="quotesList" class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading quotes...</p>
            </div>
        </div>

        <!-- Stock Summary -->
        <div class="form-card">
            <h3><i class="fas fa-chart-bar"></i> Stock Summary</h3>
            <div class="chart-container">
                <canvas id="stockChart"></canvas>
            </div>
        </div>

        <!-- Customer Feedback Manager -->
        <div class="form-card">
            <h3><i class="fas fa-comments"></i> Customer Feedback Manager</h3>
            <p>Review and manage testimonials submitted by customers.</p>
            
            <div class="admin-actions" style="margin-bottom: 1.5rem;">
                <button class="btn-primary" id="refreshPendingBtn">
                    <i class="fas fa-sync-alt"></i> Refresh Pending List
                </button>
                <button class="btn-secondary" id="viewAllBtn">
                    <i class="fas fa-list"></i> View All
                </button>
            </div>
            
            <h4>Pending Review</h4>
            <div id="pendingFeedbackList">
                <p><i>Click "Refresh Pending List" to load submissions.</i></p>
            </div>
        </div>

        <!-- FAQ Management -->
        <div class="form-card">
            <h3><i class="fas fa-question-circle"></i> FAQ Management</h3>
            <p>Manage Frequently Asked Questions shown on the FAQ page.</p>
            
            <!-- Add New FAQ Form -->
            <h4>Add New FAQ</h4>
            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
                <div class="form-group">
                    <label for="faqQuestion"><i class="fas fa-question"></i> Question</label>
                    <input type="text" id="faqQuestion" placeholder="e.g., What is your delivery area?">
                </div>
                <div class="form-group">
                    <label for="faqAnswer"><i class="fas fa-comment-alt"></i> Answer</label>
                    <textarea id="faqAnswer" rows="3" placeholder="e.g., We offer free delivery within 5km..."></textarea>
                </div>
                <div class="form-group">
                    <label for="faqOrder"><i class="fas fa-sort-numeric-down"></i> Display Order</label>
                    <input type="number" id="faqOrder" placeholder="1" value="1">
                    <small>Lower numbers appear first on the FAQ page.</small>
                </div>
                <button class="btn-primary" id="addFaqBtn">
                    <i class="fas fa-plus-circle"></i> Add FAQ
                </button>
            </div>
            
            <!-- Existing FAQs List -->
            <h4>Existing FAQs</h4>
            <button class="btn-secondary" id="refreshFaqsBtn" style="margin-bottom: 1rem;">
                <i class="fas fa-sync-alt"></i> Refresh List
            </button>
            <div id="faqsListAdmin">
                <p style="text-align: center; padding: 2rem; color: #999;">
                    Click "Refresh List" to load existing FAQs.
                </p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="admin.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Multi-image management
        let imageInputs = 1;
        
        // Quotes Management Variables
        let quotesFirebaseApp;
        let quotesDb;
        
        // Add event listener to form to handle submission
        document.addEventListener('DOMContentLoaded', function() {
            // Load categories when page loads
            if (window.loadCategories) {
                loadCategories();
            }
            
            // Initialize image previews
            updateImagePreviews();
            
            // Initialize quotes management
            initializeQuotesManagement();
        });
        
        function addImageInput() {
            const container = document.getElementById('imagesContainer');
            const newInput = document.createElement('div');
            newInput.className = 'image-input-group';
            newInput.innerHTML = `
                <input type="text" class="image-url" 
                       placeholder="Enter image filename (e.g., notebook${imageInputs + 1}.jpg)" 
                       data-index="${imageInputs}"
                       oninput="previewImage(this)">
                <button type="button" class="btn-remove-image" onclick="removeImageInput(this)">×</button>
            `;
            container.appendChild(newInput);
            imageInputs++;
            
            // Enable remove buttons if more than one input
            const removeButtons = container.querySelectorAll('.btn-remove-image');
            if (removeButtons.length > 1) {
                removeButtons.forEach(btn => btn.disabled = false);
            }
            
            updateImagePreviews();
        }
        
        function removeImageInput(button) {
            const container = document.getElementById('imagesContainer');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateImagePreviews();
            }
            
            // Disable remove button if only one input remains
            const removeButtons = container.querySelectorAll('.btn-remove-image');
            if (removeButtons.length === 1) {
                removeButtons[0].disabled = true;
            }
        }
        
        function previewImage(input) {
            updateImagePreviews();
        }
        
       function updateImagePreviews() {
    const inputs = document.querySelectorAll('.image-url');
    const previewsContainer = document.getElementById('imagePreviews');
    
    // Clear previous previews
    previewsContainer.innerHTML = '';
    
    let hasImages = false;
    
    inputs.forEach((input, index) => {
        const filename = input.value.trim();
        if (filename) {
            hasImages = true;
            
            // Remove any existing error class
            input.classList.remove('image-error');
            
            // FIXED: No duplicate prefix
            let imageUrl = filename;
            if (!filename.startsWith('http://') && 
                !filename.startsWith('https://') && 
                !filename.startsWith('data:') &&
                !filename.startsWith('assets/products/')) {
                imageUrl = `assets/products/${filename}`;
            }
            
            const preview = document.createElement('div');
            preview.className = 'image-preview-item';
            preview.dataset.index = index;
            
            preview.innerHTML = `
                <img src="${imageUrl}" alt="Preview" 
                     onerror="this.onerror=null; this.src='https://via.placeholder.com/120x100?text=Image+${index + 1}'">
                <span>${filename}</span>
            `;
            
            previewsContainer.appendChild(preview);
        }
    });
    
    if (!hasImages) {
        previewsContainer.innerHTML = `
            <div style="width: 100%; text-align: center; padding: 30px; color: #999;">
                <i class="fas fa-images" style="font-size: 40px; margin-bottom: 10px;"></i>
                <p>Enter image filenames above to see previews</p>
            </div>
        `;
    }
}
        
        
        // Get image URLs from form
        function getImageUrls() {
            const inputs = document.querySelectorAll('.image-url');
            const urls = [];
            
            inputs.forEach(input => {
                const value = input.value.trim();
                if (value) {
                    urls.push(value);
                }
            });
            
            return urls;
        }
        
        // Set image URLs in form for editing
        function setImageUrls(urls) {
            const container = document.getElementById('imagesContainer');
            container.innerHTML = '';
            
            if (urls && urls.length > 0) {
                urls.forEach((url, index) => {
                    const div = document.createElement('div');
                    div.className = 'image-input-group';
                    div.innerHTML = `
                        <input type="text" class="image-url" 
                               value="${url}" 
                               data-index="${index}"
                               oninput="previewImage(this)">
                        <button type="button" class="btn-remove-image" onclick="removeImageInput(this)">×</button>
                    `;
                    container.appendChild(div);
                });
                imageInputs = urls.length;
            } else {
                // Add one empty input if no images
                const div = document.createElement('div');
                div.className = 'image-input-group';
                div.innerHTML = `
                    <input type="text" class="image-url" 
                           placeholder="Enter image filename (e.g., notebook1.jpg)" 
                           data-index="0" required
                           oninput="previewImage(this)">
                    <button type="button" class="btn-remove-image" onclick="removeImageInput(this)" disabled>×</button>
                `;
                container.appendChild(div);
                imageInputs = 1;
            }
            
            // Enable/disable remove buttons
            const removeButtons = container.querySelectorAll('.btn-remove-image');
            if (removeButtons.length > 1) {
                removeButtons.forEach(btn => btn.disabled = false);
            } else {
                removeButtons[0].disabled = true;
            }
            
            updateImagePreviews();
        }
        
        // Global functions to be called from admin.js
        window.setProductFormData = function(product) {
            document.getElementById('productName').value = product.name || '';
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('productPrice').value = product.price || '';
            document.getElementById('productStock').value = product.stock || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productFeatures').value = product.features || '';
            document.getElementById('editProductId').value = product.id || '';
            
            // Set images
            setImageUrls(product.images || []);
            
            // Update button text
            document.getElementById('submitBtn').innerHTML = '<i class="fas fa-save"></i> Update Product';
            document.getElementById('cancelEdit').style.display = 'inline-block';
        };
        
        window.resetProductForm = function() {
            document.getElementById('productForm').reset();
            document.getElementById('editProductId').value = '';
            document.getElementById('submitBtn').innerHTML = '<i class="fas fa-save"></i> Add Product';
            document.getElementById('cancelEdit').style.display = 'none';
            
            // Reset images to one input
            setImageUrls([]);
        };
        
        // Cancel edit button
        document.getElementById('cancelEdit').addEventListener('click', function() {
            if (window.resetForm) {
                window.resetForm();
            } else if (window.resetProductForm) {
                window.resetProductForm();
            }
        });
        
        // ============ QUOTES MANAGEMENT FUNCTIONS ============
        
        async function initializeQuotesManagement() {
            try {
                // Import Firebase modules for quotes
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js");
                const { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy } = 
                    await import("https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js");
                
                // Firebase Configuration (same as main site)
                const firebaseConfig = {
                    apiKey: "AIzaSyAZe6bywYSgnMFZsef1xgfPFQBkw4y7tco",
                    authDomain: "sarm-enterprises.firebaseapp.com",
                    projectId: "sarm-enterprises",
                    storageBucket: "sarm-enterprises.firebasestorage.app",
                    messagingSenderId: "790231205096",
                    appId: "1:790231205096:web:656c5fc47c6a675e1ef55d",
                    measurementId: "G-5M1ZM089KH"
                };
                
                // Initialize Firebase for quotes
                quotesFirebaseApp = initializeApp(firebaseConfig, "quotesApp");
                quotesDb = getFirestore(quotesFirebaseApp);
                
                // Load quotes
                await loadQuotes();
                
                // Setup event listeners
                setupQuotesEventListeners();
                
            } catch (error) {
                console.error("Error initializing quotes management:", error);
                showQuotesMessage('Error initializing quotes system. Please refresh the page.', 'error');
            }
        }
        
        function setupQuotesEventListeners() {
            // Quote status toggle
            document.getElementById('quoteStatus').addEventListener('change', function() {
                document.getElementById('statusText').textContent = this.checked ? 'Active' : 'Inactive';
            });
            
            // Quote form submission
            document.getElementById('quoteForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveQuote();
            });
            
            // Cancel quote edit
            document.getElementById('cancelQuoteBtn').addEventListener('click', resetQuoteForm);
        }
        
        async function loadQuotes() {
            try {
                const q = query(collection(quotesDb, "quotes"), orderBy("order", "asc"));
                const querySnapshot = await getDocs(q);
                
                const quotesList = document.getElementById('quotesList');
                let quotesCount = 0;
                
                if (querySnapshot.empty) {
                    quotesList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-quote-left" style="font-size: 40px; margin-bottom: 20px;"></i>
                            <p>No quotes found. Add your first quote!</p>
                        </div>
                    `;
                } else {
                    quotesList.innerHTML = '';
                    querySnapshot.forEach((doc) => {
                        quotesCount++;
                        const quote = doc.data();
                        const quoteId = doc.id;
                        
                        const quoteElement = document.createElement('div');
                        quoteElement.className = 'quote-item';
                        quoteElement.innerHTML = `
                            <div class="quote-text">"${quote.text}"</div>
                            <div class="quote-author">- ${quote.author}</div>
                            <div class="quote-meta">
                                <div>
                                    Order: <strong>${quote.order || 1}</strong>
                                    <span class="status-badge ${quote.isActive ? 'status-active' : 'status-inactive'}">
                                        ${quote.isActive ? 'Active' : 'Inactive'}
                                    </span>
                                </div>
                                <div>ID: ${quoteId.substring(0, 8)}...</div>
                            </div>
                            <div class="quote-actions">
                                <button class="btn-small edit-quote-btn" data-id="${quoteId}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-small btn-danger delete-quote-btn" data-id="${quoteId}">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        `;
                        
                        quotesList.appendChild(quoteElement);
                    });
                    
                    // Update stats
                    document.getElementById('totalQuotes').textContent = `${quotesCount} Quotes`;
                }
                
                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.edit-quote-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const quoteId = e.target.closest('.edit-quote-btn').getAttribute('data-id');
                        await editQuote(quoteId);
                    });
                });
                
                document.querySelectorAll('.delete-quote-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const quoteId = e.target.closest('.delete-quote-btn').getAttribute('data-id');
                        if (confirm('Are you sure you want to delete this quote?')) {
                            await deleteQuote(quoteId);
                        }
                    });
                });
                
            } catch (error) {
                console.error("Error loading quotes:", error);
                document.getElementById('quotesList').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc3545;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 40px; margin-bottom: 20px;"></i>
                        <p>Error loading quotes. Please check your connection.</p>
                    </div>
                `;
            }
        }
        
        async function editQuote(quoteId) {
            try {
                const { getDoc } = await import("https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js");
                const docRef = doc(quotesDb, "quotes", quoteId);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const quote = docSnap.data();
                    
                    // Fill form with quote data
                    document.getElementById('quoteId').value = quoteId;
                    document.getElementById('quoteText').value = quote.text;
                    document.getElementById('quoteAuthor').value = quote.author;
                    document.getElementById('quoteOrder').value = quote.order || 1;
                    document.getElementById('quoteStatus').checked = quote.isActive !== false;
                    document.getElementById('statusText').textContent = quote.isActive !== false ? 'Active' : 'Inactive';
                    
                    // Update form for edit mode
                    document.getElementById('quoteFormTitle').textContent = 'Edit Quote';
                    document.getElementById('submitQuoteBtn').innerHTML = '<i class="fas fa-save"></i> Update Quote';
                    document.getElementById('submitQuoteBtn').className = 'btn-primary';
                    document.getElementById('cancelQuoteBtn').style.display = 'inline-block';
                    
                    // Scroll to form
                    document.getElementById('quoteText').focus();
                }
                
            } catch (error) {
                console.error("Error loading quote:", error);
                showQuotesMessage('Error loading quote details', 'error');
            }
        }
        
        async function deleteQuote(quoteId) {
            try {
                await deleteDoc(doc(quotesDb, "quotes", quoteId));
                showQuotesMessage('Quote deleted successfully');
                await loadQuotes();
            } catch (error) {
                console.error("Error deleting quote:", error);
                showQuotesMessage('Error deleting quote', 'error');
            }
        }
        
        async function saveQuote() {
            const quoteData = {
                text: document.getElementById('quoteText').value.trim(),
                author: document.getElementById('quoteAuthor').value.trim(),
                order: parseInt(document.getElementById('quoteOrder').value) || 1,
                isActive: document.getElementById('quoteStatus').checked,
                updatedAt: new Date().toISOString()
            };
            
            if (!quoteData.text || !quoteData.author) {
                showQuotesMessage('Please fill in all required fields', 'error');
                return;
            }
            
            try {
                const quoteId = document.getElementById('quoteId').value;
                
                if (quoteId) {
                    // Update existing quote
                    await updateDoc(doc(quotesDb, "quotes", quoteId), quoteData);
                    showQuotesMessage('Quote updated successfully');
                } else {
                    // Add new quote
                    quoteData.createdAt = new Date().toISOString();
                    await addDoc(collection(quotesDb, "quotes"), quoteData);
                    showQuotesMessage('Quote added successfully');
                }
                
                resetQuoteForm();
                await loadQuotes();
                
            } catch (error) {
                console.error("Error saving quote:", error);
                showQuotesMessage('Error saving quote', 'error');
            }
        }
        
        function resetQuoteForm() {
            document.getElementById('quoteForm').reset();
            document.getElementById('quoteId').value = '';
            document.getElementById('quoteStatus').checked = true;
            document.getElementById('statusText').textContent = 'Active';
            document.getElementById('quoteFormTitle').textContent = 'Add New Quote';
            document.getElementById('submitQuoteBtn').innerHTML = '<i class="fas fa-plus"></i> Add Quote';
            document.getElementById('submitQuoteBtn').className = 'btn-primary';
            document.getElementById('cancelQuoteBtn').style.display = 'none';
        }
        
        function showQuotesMessage(text, type = 'success') {
            const messageDiv = document.getElementById('quotesMessage');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
